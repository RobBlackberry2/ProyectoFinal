<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GDU-007 - Listado de usuarios</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <div class="container">

    <header>
      <div class="brand">
        <div class="logo">NHS</div>
        <div>
          <h1>listado de usuarios</h1>
          <p>visualizar y buscar usuarios registrados</p>
        </div>
      </div>
    </header>

    <main>
      <section class="form-section">
        <h2>usuarios registrados</h2>

        <div class="controls">
          <label for="buscador">buscar</label>
          <input type="text" id="buscador" placeholder="buscar por nombre, correo o id">

          <label for="filtroRol">filtrar por rol</label>
          <select id="filtroRol">
            <option value="">todos</option>
            <option value="administrador">administrador</option>
            <option value="doctor">doctor</option>
            <option value="recepcion">recepción</option>
            <option value="usuario">usuario</option>
          </select>

          <div style="margin-top:10px;">
            <button type="button" id="btnBuscar" class="btn-primary">aplicar</button>
            <button type="button" id="btnReset" class="btn-secondary">limpiar</button>
            <button type="button" id="btnSimularError" class="btn-danger">simular error de carga</button>
          </div>
        </div>

        <div id="msg" class="msg" style="display:none;"></div>

        <div id="listaUsuarios" class="list-section" aria-live="polite">
        </div>

      </section>
    </main>

  </div>

  <script>
    const usuarios = [
      { id: 'u001', nombre: 'Nelson Monge', correo: 'nelson.monge@ejemplo.com', rol: 'administrador', estado: 'activo' },
      { id: 'u002', nombre: 'Sofia Herrera', correo: 'sofia.herrera@ejemplo.com', rol: 'recepcion', estado: 'activo' },
      { id: 'u003', nombre: 'Fiorella Garcia', correo: 'fiorella.garcia@ejemplo.com', rol: 'usuario', estado: 'activo' },
      { id: 'u004', nombre: 'Nicolas Peña', correo: 'nicolas.pena@ejemplo.com', rol: 'usuario', estado: 'inactivo' },
      { id: 'u005', nombre: 'Pamela Vargas', correo: 'pamela.vargas@ejemplo.com', rol: 'usuario', estado: 'activo' }
    ];

    const listaEl = document.getElementById('listausuarios') || document.getElementById('listaUsuarios');
    const buscador = document.getElementById('buscador');
    const filtroRol = document.getElementById('filtroRol');
    const btnBuscar = document.getElementById('btnBuscar');
    const btnReset = document.getElementById('btnReset');
    const btnSimularError = document.getElementById('btnSimularError');
    const msg = document.getElementById('msg');

    let errorSimulado = false;

    function mostrarMensaje(tipo, texto) {
      msg.className = 'msg ' + (tipo === 'ok' ? 'ok' : 'err');
      msg.textContent = texto;
      msg.style.display = 'block';
    }

    function ocultarMensaje() {
      msg.style.display = 'none';
    }

    function renderLista(items) {
      ocultarMensaje();
      if (!listaEl) return;
      listaEl.innerHTML = '';

      if (items.length === 0) {
        listaEl.innerHTML = '<p style="color:var(--muted)">no se encontraron usuarios con los criterios seleccionados.</p>';
        return;
      }

      items.forEach(u => {
        const box = document.createElement('div');
        box.className = 'user-box';
        box.innerHTML = `
          <p><strong>${u.nombre}</strong> — <span style="text-transform:lowercase">${u.rol}</span> <br>
            <span style="font-size:13px;color:var(--muted)">${u.correo} · ${u.id} · estado: ${u.estado}</span>
          </p>
          <div class="buttons">
            <button type="button" class="btn-secondary" data-id="${u.id}">ver</button>
            <button type="button" class="btn-warning" data-id="${u.id}">editar</button>
          </div>
        `;
        listaEl.appendChild(box);
      });
    }

    function cargarListado() {
      if (errorSimulado) {
        if (!listaEl) return;
        listaEl.innerHTML = '';
        mostrarMensaje('err', 'error: no se pudo cargar la información. verifique la conexión o inténtelo más tarde.');
        return;
      }

      renderLista(usuarios);
      mostrarMensaje('ok', 'lista cargada correctamente.');
      setTimeout(ocultarMensaje, 2500);
    }

    function aplicarFiltros() {
      ocultarMensaje();
      const q = buscador.value.trim().toLowerCase();
      const rol = filtroRol.value;

      const filtrados = usuarios.filter(u => {
        const texto = (u.nombre + ' ' + u.correo + ' ' + u.id).toLowerCase();
        const matchTexto = q === '' || texto.includes(q);
        const matchRol = rol === '' || u.rol === rol;
        return matchTexto && matchRol;
      });

      renderLista(filtrados);

      if (!errorSimulado) {
        mostrarMensaje('ok', `mostrando ${filtrados.length} usuario(s).`);
        setTimeout(ocultarMensaje, 1800);
      }
    }

    btnBuscar.addEventListener('click', function () {
      errorSimulado = false;
      aplicarFiltros();
    });

    btnReset.addEventListener('click', function () {
      buscador.value = '';
      filtroRol.value = '';
      errorSimulado = false;
      cargarListado();
    });

    btnSimularError.addEventListener('click', function () {
      errorSimulado = true;
      cargarListado();
    });

    buscador.addEventListener('keypress', function (e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        btnBuscar.click();
      }
    });

    document.addEventListener('DOMContentLoaded', function () {
      cargarListado();
    });
  </script>
</body>
</html>

